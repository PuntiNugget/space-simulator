<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Galaxy Simulator</title>

    <style>
        /* Basic page setup */
        body {
            background-color: #00001a;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            text-align: center;
        }

        .main-layout-container {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 20px;
        }

        /* The main container for the simulation */
        .solar-system-container {
            position: relative;
            width: 600px;
            height: 600px;
            display: grid;
            place-items: center;
            border: 1px dashed #333;
            /* !! KEY CHANGE !!
               We MUST use overflow: hidden; now to contain 
               our new "pannable" universe.
            */
            overflow: hidden;
            background-color: #00000a; /* Slightly darker inner space */
        }
        
        /* * !! NEW !!
         * This is the "universe" wrapper inside the container.
         * This is the part that will pan around.
         */
        #universe {
            position: absolute;
            width: 100%;
            height: 100%;
            /* 'transform' will be set by JS for panning */
        }

        /* * !! NEW TOOL STYLES !! *
         * The styles for our new tool picker
         */
        .tools {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .tool-btn {
            padding: 10px;
            font-size: 24px;
            background-color: #333;
            color: white;
            border: 2px solid #555;
            border-radius: 5px;
            cursor: pointer;
        }
        /* Style for the *active* tool */
        .tool-btn.active {
            background-color: #fcdc4c;
            color: #000;
            border-color: #fff;
        }

        /* === Body Styles (Star, Planet, etc.) === */
        /* * !! KEY CHANGE !!
         * All bodies are now absolutely positioned by JavaScript.
         * We remove all 'animation' properties.
         */
        .celestial-body {
            position: absolute;
            border-radius: 50%;
            /* 'transform' and 'box-shadow' will be set by JS */
        }

        .star {
            background-color: #fcdc4c;
        }

        .black-hole {
            background-color: #000;
            border: 2px solid #333;
        }

        .planet {
            background-color: #3d91f0;
        }
        
        /* === UI Form Styles (Slightly modified) === */
        .controls-panel-left,
        .controls-panel-right {
            width: 280px;
            background-color: #1a1a2a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        fieldset {
            border: 1px solid #555;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        legend {
            color: #fcdc4c;
            font-weight: bold;
        }
        input, select, button {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #777;
            background-color: #333;
            color: white;
            width: 95%;
        }
        button {
            cursor: pointer;
            background-color: #fcdc4c;
            color: #000;
            font-weight: bold;
        }
        button:hover {
            background-color: #fff;
        }
    </style>
</head>
<body>

    <h1>Physics Galaxy Simulator</h1>

    <div class="main-layout-container">

        <div class="controls-panel-left">
            <fieldset>
                <legend>Tools</legend>
                <div class="tools">
                    <button class="tool-btn active" id="tool-select" title="Select / Move">ðŸ‘†</button>
                    <button class="tool-btn" id="tool-pan" title="Pan View">âœ‹</button>
                    <button class="tool-btn" id="tool-picker" title="Picker / Duplicate">ðŸ§ª</button>
                </div>
            </fieldset>

            <fieldset>
                <legend>Add Celestial Body</legend>
                <select id="body-type">
                    <option value="star">Star</option>
                    <option value="black-hole">Black Hole</option>
                    <option value="planet">Planet</option>
                </select>
                <input type="number" id="body-mass" placeholder="Mass (e.g., Star: 1000)">
                <input type="number" id="body-size" placeholder="Size (px, e.g., 20)">
                <input type="text" id="body-color" placeholder="Color (e.g., #ff0000)">
                <input type="number" id="orbit-distance" placeholder="Orbit Distance (px)">
                <button id="add-body-btn">Add Body</button>
            </fieldset>
        </div>

        <div class="solar-system-container">
            <div id="universe">
                </div>
        </div>

        <div class="controls-panel-right">
            <fieldset>
                <legend>Manage Galaxies</legend>
                <input type="text" id="galaxy-name" placeholder="Galaxy Name">
                <button id="save-galaxy-btn">Save</button>
                <select id="load-galaxy-menu"></select>
                <button id="load-galaxy-btn">Load</button>
                <button id="clear-galaxy-btn">Clear All</button>
            </fieldset>
            
            <fieldset id="selection-info" style="display: none;">
                <legend>Selection Info</legend>
                <div id="selection-name"></div>
                <button id="delete-btn" style="background-color: #c1440e;">Delete Body</button>
            </fieldset>
        </div>

    </div> <script>
        document.addEventListener('DOMContentLoaded', () => {

            // === 1. GET ALL DOM ELEMENTS ===
            const container = document.querySelector('.solar-system-container');
            const universe = document.getElementById('universe');

            // --- Tool Buttons ---
            const toolSelectBtn = document.getElementById('tool-select');
            const toolPanBtn = document.getElementById('tool-pan');
            const toolPickerBtn = document.getElementById('tool-picker');

            // --- Add Body Form ---
            const addBodyBtn = document.getElementById('add-body-btn');
            
            // --- Save/Load Form ---
            const saveGalaxyBtn = document.getElementById('save-galaxy-btn');
            const loadGalaxyBtn = document.getElementById('load-galaxy-btn');
            const clearGalaxyBtn = document.getElementById('clear-galaxy-btn');
            const loadGalaxyMenu = document.getElementById('load-galaxy-menu');

            // --- Selection Panel (for Part 2) ---
            const selectionInfoPanel = document.getElementById('selection-info');
            const selectionName = document.getElementById('selection-name');
            const deleteBtn = document.getElementById('delete-btn');


            // === 2. CORE SIMULATION STATE ===
            let currentTool = 'select'; // 'select', 'pan', 'picker'
            let isMouseDown = false;
            
            // Viewport/Camera state for panning
            let viewport = { x: 0, y: 0 };
            
            // Physics constant
            const G = 1; // Gravitational constant. Tweak this!
            
            // Our galaxy "state". Now includes physics data!
            let currentGalaxy = {
                // Central body is now just the first body in the array
                // with high mass and isStatic = true.
                bodies: []
            };
            
            // Map to store HTML elements for each body
            let bodyElements = new Map();


            // === 3. THE PHYSICS & RENDER "GAME LOOP" ===
            
            /**
             * This is the main loop. It runs 60x per second.
             * It updates physics AND renders the screen.
             */
            function simulationLoop() {
                // 1. Update Physics
                updatePhysics();
                
                // 2. Render Screen
                renderGalaxy();
                
                // 3. Loop
                requestAnimationFrame(simulationLoop);
            }

            /**
             * Calculates all forces and updates object positions.
             */
            function updatePhysics() {
                // Loop through each body to calculate forces
                for (let i = 0; i < currentGalaxy.bodies.length; i++) {
                    const bodyA = currentGalaxy.bodies[i];
                    
                    // Reset forces for this frame
                    bodyA.fx = 0;
                    bodyA.fy = 0;

                    // Calculate force from every *other* body
                    for (let j = 0; j < currentGalaxy.bodies.length; j++) {
                        if (i === j) continue; // Don't attract yourself
                        
                        const bodyB = currentGalaxy.bodies[j];
                        
                        const dx = bodyB.x - bodyA.x;
                        const dy = bodyB.y - bodyA.y;
                        const distSq = dx * dx + dy * dy;
                        const dist = Math.sqrt(distSq);
                        
                        // F = G * (m1 * m2) / r^2
                        const force = (G * bodyA.mass * bodyB.mass) / distSq;
                        
                        // Add to total force
                        bodyA.fx += (force * dx) / dist;
                        bodyA.fy += (force * dy) / dist;
                    }
                }

                // Now apply forces and check for black hole collisions
                let bodiesToDelete = [];
                const centralBody = currentGalaxy.bodies[0]; // Assume first body is the main one

                for (let i = 0; i < currentGalaxy.bodies.length; i++) {
                    const body = currentGalaxy.bodies[i];

                    // If it's static, it doesn't move.
                    if (body.isStatic) continue;

                    // --- Black Hole Physics ---
                    // Check if it's too close to a black hole
                    if (centralBody && centralBody.type === 'black-hole') {
                        const dx = centralBody.x - body.x;
                        const dy = centralBody.y - body.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        
                        // If inside the black hole's "size", mark for deletion
                        if (dist < (centralBody.size / 2)) {
                            bodiesToDelete.push(body.id);
                            continue; // Stop processing this deleted body
                        }
                    }

                    // --- Apply Physics (Newton's Laws) ---
                    // a = F / m
                    const ax = body.fx / body.mass;
                    const ay = body.fy / body.mass;
                    
                    // v = v_initial + a * t (we'll assume t=1 frame)
                    body.vx += ax;
                    body.vy += ay;
                    
                    // p = p_initial + v * t
                    body.x += body.vx;
                    body.y += body.vy;
                }
                
                // --- Deletion Step ---
                // Safely delete bodies marked for deletion
                if (bodiesToDelete.length > 0) {
                    currentGalaxy.bodies = currentGalaxy.bodies.filter(body => {
                        const shouldDelete = bodiesToDelete.includes(body.id);
                        if (shouldDelete) {
                            // Also remove the HTML element
                            const el = bodyElements.get(body.id);
                            if (el) el.remove();
                            bodyElements.delete(body.id);
                        }
                        return !shouldDelete;
                    });
                }
            }


            /**
             * Renders all bodies based on the currentGalaxy state.
             */
            function renderGalaxy() {
                // 1. Pan the universe
                // We offset the *entire* universe div.
                // 300, 300 is the center of the 600x600 container.
                const viewX = -viewport.x + 300;
                const viewY = -viewport.y + 300;
                universe.style.transform = `translate(${viewX}px, ${viewY}px)`;
                
                // 2. Render all bodies
                for (const body of currentGalaxy.bodies) {
                    let el = bodyElements.get(body.id);
                    
                    // If element doesn't exist, create it
                    if (!el) {
                        el = document.createElement('div');
                        el.className = 'celestial-body ' + body.type;
                        el.style.width = `${body.size}px`;
                        el.style.height = `${body.size}px`;
                        el.style.backgroundColor = body.color; // Set color
                        bodyElements.set(body.id, el);
                        universe.appendChild(el);
                    }
                    
                    // --- Gravity Indicator ---
                    // This is your gravitational pull visual!
                    // We'll use a box-shadow that gets stronger
                    // as it gets closer to the central body.
                    let shadowOpacity = 0.2;
                    if (currentGalaxy.bodies.length > 0 && !body.isStatic) {
                        const centralBody = currentGalaxy.bodies[0];
                        const dx = centralBody.x - body.x;
                        const dy = centralBody.y - body.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        
                        // Closer = more opaque shadow. Tweak these numbers!
                        shadowOpacity = Math.min(1, 100 / dist);
                    }
                    
                    // For black holes, use their own color glow
                    let shadowColor = body.type === 'black-hole' ? '#8a00c2' : body.color;
                    
                    el.style.boxShadow = `0 0 ${body.size * 2}px rgba(255, 255, 255, ${shadowOpacity})`;
                    
                    // Update position
                    // We offset by half its size to center it
                    const elX = body.x - (body.size / 2);
                    const elY = body.y - (body.size / 2);
                    el.style.transform = `translate(${elX}px, ${elY}px)`;
                }
            }
            
            
            // === 4. UI EVENT LISTENERS ===
            
            // --- Tool Selection ---
            function setActiveTool(tool) {
                currentTool = tool;
                // Remove 'active' from all
                toolSelectBtn.classList.remove('active');
                toolPanBtn.classList.remove('active');
                toolPickerBtn.classList.remove('active');
                // Add 'active' to the clicked one
                document.getElementById(`tool-${tool}`).classList.add('active');
            }
            toolSelectBtn.onclick = () => setActiveTool('select');
            toolPanBtn.onclick = () => setActiveTool('pan');
            toolPickerBtn.onclick = () => setActiveTool('picker');

            // --- Add a New Body ---
            addBodyBtn.addEventListener('click', () => {
                const type = document.getElementById('body-type').value;
                const mass = parseFloat(document.getElementById('body-mass').value) || 10;
                const size = parseFloat(document.getElementById('body-size').value) || 10;
                const color = document.getElementById('body-color').value || '#ffffff';
                const orbitDist = parseFloat(document.getElementById('orbit-distance').value) || 100;

                let newBody = {
                    id: Date.now(), // Unique ID
                    type: type,
                    mass: mass,
                    size: size,
                    color: color,
                    x: 0, y: 0, // Position
                    vx: 0, vy: 0, // Velocity
                    fx: 0, fy: 0, // Force
                    isStatic: false
                };

                // If it's the *first* body, make it static and put it at 0,0
                if (currentGalaxy.bodies.length === 0) {
                    newBody.isStatic = true;
                    // Position is 0,0 (relative to universe, not screen)
                } else {
                    // It's a planet. Give it an orbit.
                    const centralBody = currentGalaxy.bodies[0];
                    
                    // Position it
                    newBody.x = centralBody.x + orbitDist;
                    newBody.y = centralBody.y;
                    
                    // Give it an initial velocity for a circular orbit
                    // v = sqrt(G * M_central / r)
                    const v = Math.sqrt((G * centralBody.mass) / orbitDist);
                    newBody.vy = -v; // Move "up" to orbit counter-clockwise
                }
                
                currentGalaxy.bodies.push(newBody);
                // The render loop will automatically find and draw it.
            });

            // --- Save/Load Functions (Mostly Unchanged) ---
            saveGalaxyBtn.addEventListener('click', () => {
                const galaxyName = document.getElementById('galaxy-name').value;
                if (!galaxyName) return alert('Please enter a name!');
                
                // We now save the 'bodies' array and the 'viewport'
                const saveData = {
                    bodies: currentGalaxy.bodies,
                    viewport: viewport
                };
                localStorage.setItem(galaxyName, JSON.stringify(saveData));
                
                alert(`Galaxy "${galaxyName}" saved!`);
                populateLoadMenu();
            });

            loadGalaxyBtn.addEventListener('click', () => {
                const galaxyName = loadGalaxyMenu.value;
                if (!galaxyName) return alert('Please select a galaxy.');
                
                const savedData = JSON.parse(localStorage.getItem(galaxyName));
                
                // Clear existing galaxy
                clearAll(); 
                
                // Load new data
                currentGalaxy.bodies = savedData.bodies;
                viewport = savedData.viewport;
                
                alert(`Galaxy "${galaxyName}" loaded!`);
                // Render loop will handle drawing
            });

            clearGalaxyBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the current galaxy?')) {
                    clearAll();
                }
            });

            function clearAll() {
                currentGalaxy.bodies = [];
                // Remove all HTML elements
                universe.innerHTML = '';
                bodyElements.clear();
                // Reset viewport
                viewport = { x: 0, y: 0 };
            }

            function populateLoadMenu() {
                loadGalaxyMenu.innerHTML = '';
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = key;
                    loadGalaxyMenu.appendChild(option);
                }
            }

            // === 5. START THE SIMULATOR ===
            populateLoadMenu();
            requestAnimationFrame(simulationLoop); // Start the game loop!
        });
    </script>

</body>
</html>
